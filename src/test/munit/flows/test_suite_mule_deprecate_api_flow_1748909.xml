<?xml version="1.0" ?>
<mule xmlns:os="http://www.mulesoft.org/schema/mule/os" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:validation="http://www.mulesoft.org/schema/mule/validation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:munit="http://www.mulesoft.org/schema/mule/munit" xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xsi:schemaLocation="     http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd     http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd     http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd     http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd http://www.mulesoft.org/schema/mule/validation http://www.mulesoft.org/schema/mule/validation/current/mule-validation.xsd http://www.mulesoft.org/schema/mule/os http://www.mulesoft.org/schema/mule/os/current/mule-os.xsd">
  <munit:config name="test_suite_mule_deprecate_api_flow_1748909.xml"/>
  <munit:test name="test_suite_mule_deprecate_api_flow_0" description="Happy path scenario where the flow processes a list of APIs, some of which are 'unregistered' with zero active contracts (and thus deleted), and others are active (and thus not deleted). This covers all HTTP requests, both branches of the Choice, For Each, and Parallel For Each logic.">
    <munit:behavior>
      <!-- Set up initial HTTP request event with required variables -->
      <munit:set-event doc:name="Set Event">
        <munit:attributes value="#[{                 'headers': {                     'content-type': 'application/json'                 },                 'listenerPath': '/apideprecate',                 'method': 'GET'             }]" mediaType="application/json" encoding="UTF-8"/>
        <munit:variables>
          <munit:variable key="limit" value="#[20]" mediaType="application/java"/>
          <munit:variable key="offset" value="#[0]" mediaType="application/java"/>
          <munit:variable key="totalCount" value="#[2]" mediaType="application/java"/>
          <munit:variable key="organization_id" value="55bf2ad9-16b8-428f-9f36-fc687e5cc3d4" mediaType="text/plain"/>
          <munit:variable key="environment_id" value="55765363-6940-42c1-9083-09ceeba33ce7" mediaType="text/plain"/>
          <munit:variable key="user_client_id" value="58aa60bfac09489d9bbed42086db7067" mediaType="text/plain"/>
          <munit:variable key="user_client_secret" value="6C6077eE6E084C478a91c3b46E2c36c5" mediaType="text/plain"/>
        </munit:variables>
      </munit:set-event>
      <!-- Mock authentication HTTP POST request -->
      <munit-tools:mock-when doc:name="Mock Authentication Request" processor="http:request">
        <munit-tools:with-attributes>
          <munit-tools:with-attribute attributeName="doc:name" whereValue="Request Authentication"/>
        </munit-tools:with-attributes>
        <munit-tools:then-return>
          <munit-tools:payload value="#[MunitTools::getResourceAsString('test_suite_mule_deprecate_api_flow_1748909/mock_data_scenario_0/auth_response.json')]" mediaType="application/json" encoding="UTF-8"/>
          <munit-tools:variables>
            <munit-tools:variable key="authRespVar" value="#[output application/java --- read(MunitTools::getResourceAsString('test_suite_mule_deprecate_api_flow_1748909/mock_data_scenario_0/auth_response.json'), 'application/json')]" mediaType="application/java"/>
          </munit-tools:variables>
        </munit-tools:then-return>
      </munit-tools:mock-when>
      <!-- Mock first HTTP GET request for total APIs -->
      <munit-tools:mock-when doc:name="Mock First Get APIs Request" processor="http:request">
        <munit-tools:with-attributes>
          <munit-tools:with-attribute attributeName="doc:name" whereValue="Request All APIs"/>
          <munit-tools:with-attribute attributeName="doc:id" whereValue="a8295991-12c4-492d-a202-040fe004f0b3"/>
        </munit-tools:with-attributes>
        <munit-tools:then-return>
          <munit-tools:payload value="#[MunitTools::getResourceAsString('test_suite_mule_deprecate_api_flow_1748909/mock_data_scenario_0/total_apis_response.json')]" mediaType="application/json" encoding="UTF-8"/>
          <munit-tools:variables>
            <munit-tools:variable key="totalCount" value="#[2]" mediaType="application/java"/>
            <munit-tools:variable key="assets" value="#[output application/java --- read(MunitTools::getResourceAsString('test_suite_mule_deprecate_api_flow_1748909/mock_data_scenario_0/total_apis_response.json'), 'application/json').assets]" mediaType="application/java"/>
          </munit-tools:variables>
        </munit-tools:then-return>
      </munit-tools:mock-when>
      <!-- Mock second HTTP GET request for paginated APIs -->
      <munit-tools:mock-when doc:name="Mock Paginated Get APIs Request" processor="http:request">
        <munit-tools:with-attributes>
          <munit-tools:with-attribute attributeName="doc:name" whereValue="Request All APIs"/>
          <munit-tools:with-attribute attributeName="doc:id" whereValue="7ad0c8ce-4f36-4a58-96a6-e43064a5042f"/>
        </munit-tools:with-attributes>
        <munit-tools:then-return>
          <munit-tools:payload value="#[MunitTools::getResourceAsString('test_suite_mule_deprecate_api_flow_1748909/mock_data_scenario_0/paginated_apis_response.json')]" mediaType="application/json" encoding="UTF-8"/>
          <munit-tools:variables>
            <munit-tools:variable key="assets" value="#[output application/java --- read(MunitTools::getResourceAsString('test_suite_mule_deprecate_api_flow_1748909/mock_data_scenario_0/paginated_apis_response.json'), 'application/json').assets]" mediaType="application/java"/>
          </munit-tools:variables>
        </munit-tools:then-return>
      </munit-tools:mock-when>
      <!-- Mock HTTP DELETE request -->
      <munit-tools:mock-when doc:name="Mock Delete API Request" processor="http:request">
        <munit-tools:with-attributes>
          <munit-tools:with-attribute attributeName="doc:name" whereValue="delete unregisterd API"/>
        </munit-tools:with-attributes>
        <munit-tools:then-return>
          <munit-tools:payload value="#[MunitTools::getResourceAsString('test_suite_mule_deprecate_api_flow_1748909/mock_data_scenario_0/delete_api_response.json')]" mediaType="application/json" encoding="UTF-8"/>
        </munit-tools:then-return>
      </munit-tools:mock-when>
    </munit:behavior>
    <munit:execution>
      <flow-ref name="muledeprecateapiFlow" doc:name="Flow Reference"/>
    </munit:execution>
    <munit:validation>
      <!-- Add sleep for parallel processing -->
      <munit-tools:sleep time="5000" doc:name="Sleep"/>
      <!-- Verify authentication request was made -->
      <munit-tools:verify-call doc:name="Verify Authentication Request" processor="http:request" times="1">
        <munit-tools:with-attributes>
          <munit-tools:with-attribute attributeName="doc:name" whereValue="Request Authentication"/>
        </munit-tools:with-attributes>
      </munit-tools:verify-call>
      <!-- Verify initial GET APIs request was made -->
      <munit-tools:verify-call doc:name="Verify First Get APIs Request" processor="http:request" times="1">
        <munit-tools:with-attributes>
          <munit-tools:with-attribute attributeName="doc:name" whereValue="Request All APIs"/>
          <munit-tools:with-attribute attributeName="doc:id" whereValue="a8295991-12c4-492d-a202-040fe004f0b3"/>
        </munit-tools:with-attributes>
      </munit-tools:verify-call>
      <!-- Verify paginated GET APIs request was made -->
      <munit-tools:verify-call doc:name="Verify Paginated Get APIs Request" processor="http:request" times="1">
        <munit-tools:with-attributes>
          <munit-tools:with-attribute attributeName="doc:name" whereValue="Request All APIs"/>
          <munit-tools:with-attribute attributeName="doc:id" whereValue="7ad0c8ce-4f36-4a58-96a6-e43064a5042f"/>
        </munit-tools:with-attributes>
      </munit-tools:verify-call>
      <!-- Verify DELETE request was made -->
      <munit-tools:verify-call doc:name="Verify Delete API Request" processor="http:request" times="1">
        <munit-tools:with-attributes>
          <munit-tools:with-attribute attributeName="doc:name" whereValue="delete unregisterd API"/>
        </munit-tools:with-attributes>
      </munit-tools:verify-call>
      <!-- Verify both loggers were called -->
      <munit-tools:verify-call doc:name="Verify Delete Success Logger" processor="logger" times="1">
        <munit-tools:with-attributes>
          <munit-tools:with-attribute attributeName="doc:name" whereValue="Logger"/>
          <munit-tools:with-attribute attributeName="doc:id" whereValue="892fc269-5153-45e3-9a3f-ff00c94d6f8c"/>
        </munit-tools:with-attributes>
      </munit-tools:verify-call>
      <munit-tools:verify-call doc:name="Verify API Active Logger" processor="logger" times="1">
        <munit-tools:with-attributes>
          <munit-tools:with-attribute attributeName="doc:name" whereValue="Logger"/>
          <munit-tools:with-attribute attributeName="doc:id" whereValue="60a19a1f-2a3d-4a81-8be9-ef68dbf5dc23"/>
        </munit-tools:with-attributes>
      </munit-tools:verify-call>
    </munit:validation>
  </munit:test>
</mule>